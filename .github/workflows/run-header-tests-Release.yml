name: Run Tests for Module Header Files (Release)

on:
  pull_request:
    branches: [ main ]
    paths:
      - 'headers/**'

jobs:
    test-header-files:
      name: Test changed header files
      runs-on: ubuntu-latest

      steps:
        - name: Install googletest
          run: |
            set -e
            sudo apt-get install libgtest-dev
        - uses: actions/checkout@v1

        - name: Configure as Release
          run: |
            cmake -S . -B build -DCMAKE_BUILD_TYPE=Release -DMODULE_LIST="" ..
          working-directory: ./headers/tests

        - name: Build test project
          run: |
            cmake --build .
          working-directory: ./headers/tests/build

        - name: Execute tests
          run: |
            ctest
          working-directory: ./headers/tests/build